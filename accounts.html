<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>üè¶ –†–∞—Ö—É–Ω–∫–∏</title>
  <link rel="stylesheet" href="/assets/styles/styles.css" />
  <script src="/assets/js/scripthd.js"></script>        
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="widget"></div>
  <header></header>

  <main>
    <h2>üìã –í–∞—à—ñ —Ä–∞—Ö—É–Ω–∫–∏</h2>
    <table class="account-table">
      <thead>
        <tr>
          <th>–¢–∏–ø</th>
          <th>IBAN</th>
          <th>–ë–∞–Ω–∫</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ë–∞–ª–∞–Ω—Å</th>
          <th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody id="accountList"></tbody>
    </table>

    <h3>‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–∞—Ö—É–Ω–æ–∫</h3>
    <form id="createAccountForm">
      <label>–¢–∏–ø —Ä–∞—Ö—É–Ω–∫—É:
        <select id="accountType">
          <option value="–û—Å–Ω–æ–≤–Ω–∏–π">–û—Å–Ω–æ–≤–Ω–∏–π</option>
          <option value="–î–µ–ø–æ–∑–∏—Ç">–î–µ–ø–æ–∑–∏—Ç</option>
        </select>
      </label>
      <label>–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å:
        <input type="number" id="initialAmount" min="0" step="0.01" required>
      </label>
      <button type="submit" class="action-btn">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
    </form>

    <!--<h3>‚ûï –û—Ñ–æ—Ä–º–∏—Ç–∏ –∫—Ä–µ–¥–∏—Ç</h3>
    <form id="loanForm">
      <label>–°—É–º–∞ –∫—Ä–µ–¥–∏—Ç—É:
        <input type="number" id="loanAmount" min="0" step="0.01" required>
      </label>
      <button type="submit" class="action-btn">–û—Ñ–æ—Ä–º–∏—Ç–∏</button>
    </form>

    <h3 id="cardNumberDisplay" style="display:none;">–ù–æ–º–µ—Ä –≤–∞—à–æ—ó –∫–∞—Ä—Ç–∫–∏: <span id="cardNumber"></span></h3>
-->
  </main>
  <footer></footer>
  <script src="script.js"></script>
  <script>
    function getAccounts() {
      return JSON.parse(localStorage.getItem('accounts') || '[]');
    }

    function saveAccounts(accounts) {
      localStorage.setItem('accounts', JSON.stringify(accounts));
    }

    function generateIBAN() {
      return 'UA' + Math.floor(1000000000000000000000000 + Math.random() * 9000000000000000000000000);
    }

    function generateCardNumber() {
      return '4000 1234 5678 ' + Math.floor(1000 + Math.random() * 9000);
    }

    function getCurrentUser() {
      return localStorage.getItem('currentUser');
    }

    function showAccounts() {
      const user = getCurrentUser();
      if (!user) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å!');
        location.href = 'index.html';
        return;
      }

      const tbody = document.getElementById('accountList');
      const accounts = getAccounts().filter(acc => acc.owner === user);
      tbody.innerHTML = '';

      accounts.forEach((acc, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${acc.type}</td>
          <td>${acc.iban}</td>
          <td>${acc.bank || 'MazeBank'}</td>
          <td>${acc.status || '–ê–∫—Ç–∏–≤–Ω–∏–π'}</td>
          <td>${acc.balance.toFixed(2)} –≥—Ä–Ω</td>
          <td>
            <button class="ghost" onclick="deleteAccount(${index})">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
            <button class="ghost" onclick="closeAccount(${index})">üîí –ó–∞–∫—Ä–∏—Ç–∏</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function createAccount(e) {
      e.preventDefault();
      const user = getCurrentUser();
      if (!user) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å!');
        location.href = 'index.html';
        return;
      }

      const type = document.getElementById('accountType').value;
      const amount = parseFloat(document.getElementById('initialAmount').value);
      const accounts = getAccounts();

      const iban = generateIBAN();
      const cardNumber = generateCardNumber();
      const newAccount = {
        type,
        iban,
        bank: 'MazeBank',
        status: '–ê–∫—Ç–∏–≤–Ω–∏–π',
        balance: amount,
        owner: user,
        cardNumber // –î–æ–¥–∞—î–º–æ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–∏
      };

      accounts.push(newAccount);
      saveAccounts(accounts);
      showAccounts();
      document.getElementById('createAccountForm').reset();
      // –ü–æ–∫–∞–∑—É—î–º–æ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—É
      document.getElementById('cardNumberDisplay').style.display = 'block';
      document.getElementById('cardNumber').textContent = cardNumber;
    }

    function deleteAccount(index) {
      const accounts = getAccounts();
      accounts.splice(index, 1);
      saveAccounts(accounts);
      showAccounts();
    }

    function closeAccount(index) {
      const accounts = getAccounts();
      accounts[index].status = '–ó–∞–∫—Ä–∏—Ç–∏–π';
      saveAccounts(accounts);
      showAccounts();
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∫—Ä–µ–¥–∏—Ç—É
function applyLoan(e) {
  e.preventDefault();
  
  const user = getCurrentUser();
  if (!user) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å!');
    location.href = 'index.html';
    return;
  }

  const loanAmount = parseFloat(document.getElementById('loanAmount').value);
  if (isNaN(loanAmount) || loanAmount <= 0) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É —Å—É–º—É –∫—Ä–µ–¥–∏—Ç—É.');
    return;
  }

  const accounts = getAccounts();
  const activeAccount = accounts.find(acc => acc.owner === user && acc.status === '–ê–∫—Ç–∏–≤–Ω–∏–π');

  if (activeAccount) {
    activeAccount.balance += loanAmount; // –ó–±—ñ–ª—å—à—É—î–º–æ –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—É–º—É –∫—Ä–µ–¥–∏—Ç—É
    saveAccounts(accounts); // –û–Ω–æ–≤–ª—é—î–º–æ –¥–∞–Ω—ñ –≤ localStorage
    showAccounts(); // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
    alert(`–ö—Ä–µ–¥–∏—Ç —É —Ä–æ–∑–º—ñ—Ä—ñ ${loanAmount} –≥—Ä–Ω –±—É–ª–æ —É—Å–ø—ñ—à–Ω–æ –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ –Ω–∞ –≤–∞—à —Ä–∞—Ö—É–Ω–æ–∫!`);
    document.getElementById('loanForm').reset();
  } else {
    alert('–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ä–∞—Ö—É–Ω–∫—ñ–≤ –¥–ª—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∫—Ä–µ–¥–∏—Ç—É.');
  }
}


    document.addEventListener('DOMContentLoaded', () => {
      showAccounts();
      showWidget();

      document.getElementById('createAccountForm').addEventListener('submit', createAccount);
      document.getElementById('loanForm').addEventListener('submit', applyLoan);

      document.getElementById('logoutLink').addEventListener('click', () => {
        localStorage.removeItem('currentUser');
        location.href = 'index.html';
      });
    });
  </script>
</body>
</html>
